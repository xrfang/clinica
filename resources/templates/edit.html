{{define "body"}} {{template "header"}}
<nav class="navbar navbar-expand navbar-dark bg-dark" style="padding: 0 4 0 4">
    <a class="navbar-brand" href="#">&nbsp;<span id="title">新增医案</span></a>
    <div class="collapse navbar-collapse" id="navbarMenu">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="#" role="button">
                    <i class="fas fa-user"></i>&nbsp;<b>{{.Caption}}</b>
                </a>
            </li>
        </ul>
    </div>
</nav>
<div class="container" style="margin-top:1rem">
    <div class="accordion" id="portfolio">
        <div id="info" style="padding:0.5rem 0.6rem 0.5rem 0.5rem">
           <b>[<span id="patient_name"></span>]</b>&nbsp;<span id="summary"></span>
           &nbsp;<a class="fas fa-edit" href="javascript:editCaseProp(consults)"></a>
        </div>
        <div id="consults"></div>
    </div>
</div>
</form>
</div>
<script>
    var consults = JSON.parse(`{{.Case}}`)
    console.log(consults)
    $(function () {
        $('#info').addClass("alert alert-" + caseBgColor(consults.status))
        $('#patient_name').text(consults.patient_name)
        $('#summary').text(consults.summary)
        $.each(consults.consult, function (i, c) {
            var bg = consultBgColor(c.status)
            var card = `
<div class="card">
  <div class="card-header" style="padding:0;background:${bg}" id="h_${c.id}">
    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#c_${c.id}" style="display:inline-block">
      ${fmtDateTime(c.time, "Y-m-d")}
    </button>
    <div class="dropdown" style="display:inline-block;float:right">
      <i class="fas fa-ellipsis-v" data-toggle="dropdown" style="padding:0.7rem 0.7rem"></i>
      <div class="dropdown-menu dropdown-menu-right">
        <a class="dropdown-item" href="#">编辑【主诉】</a>
        <a class="dropdown-item" href="#">编辑【诊断】</a>
        <a class="dropdown-item" href="#">编辑【辩证】</a>
        <a class="dropdown-item" href="#">编辑【思路】</a>
        <a class="dropdown-item" href="#">编辑【开方】</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="javascript:editConsultProp(consults.consult[${i}])">编辑就诊记录</a>
      </div>
    </div>
  </div>
  <div id="c_${c.id}" class="collapse" data-parent="#portfolio">
    <div class="card-body">`
            $.each(c.records, function (i, r) {
                card += `
      <div style="margin-bottom:0.3rem">
        <a data-toggle="collapse" style="font-weight:bold" href="#rec_${r.id}">[${r.category}]</a>
        &nbsp;${r.caption}&nbsp;&nbsp;<a class="fas fa-edit"></a>
      </div>
      <div style="margin-bottom:1rem;" id="rec_${r.id}" class="collapse">${r.details}</div>`
            })
            card += `
    </div>
  </div>
</div>`
            $('#consults').append(card)
        })
    })
    function editConsult(i) {

    }
</script>
{{template "caseprop"}}
{{template "consultprop"}}
{{template "footer"}} {{end}}